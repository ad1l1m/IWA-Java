name: Run WebInspect locally
on: [push, workflow_dispatch]

jobs:
  wi:
    runs-on: [self-hosted, windows, x64, webinspect]
    env:
      IWA_DIR:  C:\Users\Administrator\IWA-Java
      TARGET:   http://localhost:8888   
    steps:
      - name: cd
        run: cd C:\Users\Administrator\IWA-Java
      - name: git pull
        shell: powershell
        run: |
          git -C $env:IWA_DIR pull
      - name: run application
        run: mvn spring-boot:run
      - name: ping 
        shell: powershell
        run: ping http://localhost:8888
      # - name: Wait for app to be ready
      #   shell: pwsh
      #   run: |
      #     $u = $env:TARGET
      #     1..60 | ForEach-Object {
      #       try {
      #         # если есть actuator/health - используй его
      #         Invoke-WebRequest -UseBasicParsing -TimeoutSec 3 "$u" | Out-Null
      #         exit 0
      #       } catch { Start-Sleep 2 }
      #     }
      #     throw "Service is not responding at $u"
      # - name: scanning application
      #   shell: powershell
      #   run: wi.exe -u http://192.168.64.16:8888 -ps 1 -ep ./testing.fpr
